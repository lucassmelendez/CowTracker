CowTracker API - Backend FastAPI con Webpay Plus
API REST para el sistema de seguimiento de ganado CowTracker, desarrollada con FastAPI y con integraci√≥n completa de Webpay Plus para procesamiento de pagos, as√≠ como una integraci√≥n con la API del Banco Central de Chile para conversi√≥n de divisas. Optimizada para despliegue en Vercel.

üöÄ Caracter√≠sticas
FastAPI: Framework moderno y r√°pido para APIs
Webpay Plus: Integraci√≥n completa con el sistema de pagos de Transbank
API Banco Central: Integraci√≥n para tipos de cambio y valores UF/UTM
Documentaci√≥n autom√°tica: Swagger UI y ReDoc incluidos
CORS configurado: Listo para frontend
Validaci√≥n de datos: Con Pydantic
Variables de entorno: Configuraci√≥n segura y flexible
Optimizado para Vercel: Configuraci√≥n lista para despliegue
üìã Endpoints Disponibles
Informaci√≥n General
GET / - Mensaje de bienvenida y estado de Webpay
GET /health - Estado de salud de la API
GET /config - Verificar configuraci√≥n (sin mostrar credenciales)
GET /docs - Documentaci√≥n Swagger UI
GET /redoc - Documentaci√≥n ReDoc
Gesti√≥n de Vacas
GET /cows - Obtener todas las vacas
GET /cows/{cow_id} - Obtener una vaca espec√≠fica
POST /cows - Crear una nueva vaca
PUT /cows/{cow_id} - Actualizar una vaca
DELETE /cows/{cow_id} - Eliminar una vaca
Filtros
GET /cows/breed/{breed} - Filtrar por raza
GET /cows/health/{status} - Filtrar por estado de salud
üí≥ Webpay Plus - Pagos
POST /webpay/create-transaction - Crear una nueva transacci√≥n de pago
POST /cows/{cow_id}/purchase - Iniciar compra de una vaca espec√≠fica
POST /webpay/confirm - Confirmar una transacci√≥n (webhook)
GET /webpay/return - P√°gina de retorno despu√©s del pago
GET /webpay/status/{token} - Obtener estado de una transacci√≥n
POST /webpay/refund/{token} - Anular/reversar una transacci√≥n
Gesti√≥n de Transacciones
GET /transactions - Obtener todas las transacciones
GET /transactions/{buy_order} - Obtener transacci√≥n por orden de compra
üè¶ Banco Central de Chile
GET /bcentral/exchange-rate - Tipo de cambio (USD, EUR, etc.)
GET /bcentral/uf - Valor de la UF
GET /bcentral/utm - Valor de la UTM
GET /bcentral/economic-indicators - Indicadores econ√≥micos
GET /bcentral/series - Series disponibles
GET /bcentral/series/{code} - Serie espec√≠fica
GET /bcentral/currencies - Monedas soportadas
GET /bcentral/convert - Conversi√≥n de divisas
üõ†Ô∏è Instalaci√≥n Local
1. Configurar Variables de Entorno
Paso 1: Copia el archivo de plantilla

Paso 2: El archivo .env ya contiene las credenciales de integraci√≥n de Webpay Plus:

2. Instalar Dependencias
3. Ejecutar la Aplicaci√≥n
La API estar√° disponible en: http://localhost:8000

4. Verificar Configuraci√≥n
Visita http://localhost:8000/config para verificar que Webpay est√© configurado correctamente.

üß™ Pruebas con Webpay Plus
Datos de Prueba (Ambiente de Integraci√≥n)
Tarjeta de Cr√©dito: 4051 8856 0044 6623
CVV: 123
Fecha de vencimiento: Cualquier fecha futura (ej: 12/25)
RUT: 11.111.111-1
P√°gina de Prueba
Abre el archivo test_webpay.html en tu navegador para probar la integraci√≥n completa.

üí≥ Flujo de Pago Webpay Plus
Crear Transacci√≥n: El cliente solicita una transacci√≥n
Redirecci√≥n: Se redirige al usuario a Webpay Plus
Pago: El usuario ingresa sus datos de tarjeta
Retorno: Webpay redirige de vuelta a tu aplicaci√≥n
Confirmaci√≥n: Se confirma autom√°ticamente la transacci√≥n
Resultado: Se muestra el resultado del pago
üåê Despliegue en Vercel
Variables de Entorno en Vercel
En el dashboard de Vercel, configura las siguientes variables de entorno:

Opci√≥n 1: Desde GitHub
Sube tu c√≥digo a un repositorio de GitHub
Conecta tu cuenta de Vercel con GitHub
Importa el proyecto desde Vercel Dashboard
Configura las variables de entorno
Vercel detectar√° autom√°ticamente la configuraci√≥n
Opci√≥n 2: Vercel CLI
Instalar Vercel CLI
Iniciar sesi√≥n
Desplegar
Configurar variables de entorno
Desplegar a producci√≥n
üîí Configuraci√≥n de Producci√≥n
Para usar en producci√≥n, actualiza tu archivo .env:

Requisitos para producci√≥n:

Obtener credenciales reales de Transbank
Implementar HTTPS (obligatorio para Webpay)
Configurar dominio real en URLs de retorno
Validar certificados SSL
üîí Consideraciones de Seguridad
HTTPS obligatorio en producci√≥n para Webpay
Variables de entorno para credenciales sensibles
Archivo .env excluido del control de versiones
Configurar CORS con dominios espec√≠ficos
Validar siempre las respuestas de Webpay
Implementar logs de transacciones
Implementar rate limiting para endpoints de pago
üóÑÔ∏è Base de Datos
Actualmente usa una base de datos en memoria para demostraci√≥n. Para producci√≥n, considera:

PostgreSQL con SQLAlchemy para transacciones
Redis para cache de sesiones
MongoDB para logs de transacciones
SQLite para proyectos peque√±os
üìö Documentaci√≥n API
Una vez desplegada, la documentaci√≥n estar√° disponible en:

Swagger UI: https://tu-api.vercel.app/docs
ReDoc: https://tu-api.vercel.app/redoc
üÜò Soluci√≥n de Problemas
Error: "WEBPAY_COMMERCE_CODE no est√° configurado"
Error: "Token no v√°lido"
Verifica que el token no haya expirado (5 minutos)
Aseg√∫rate de usar el token correcto en la confirmaci√≥n
Error: "Transacci√≥n rechazada"
Verifica los datos de la tarjeta de prueba
Aseg√∫rate de estar en el ambiente correcto (integraci√≥n/producci√≥n)
Error de CORS
Configura los or√≠genes permitidos en CORS_ORIGINS
Verifica que el frontend est√© en un dominio permitido
Webpay no configurado
Verifica que el archivo .env exista y tenga las variables correctas
Revisa los logs de la aplicaci√≥n al iniciar
üìû Soporte
Para m√°s informaci√≥n sobre Webpay Plus:

Documentaci√≥n oficial de Transbank
SDK Python de Transbank
Para informaci√≥n sobre la API del Banco Central:

Documentaci√≥n oficial del Banco Central
